

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TODO: Host configuration &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../static/jquery.js"></script>
        <script type="text/javascript" src="../../static/underscore.js"></script>
        <script type="text/javascript" src="../../static/doctools.js"></script>
        <script type="text/javascript" src="../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Getting Started" href="../user/user-documentation.html" />
    <link rel="prev" title="Scipion configuration" href="scipion-configuration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install-from-sources.html">Installing from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TODO: Host configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#submit-prefix-run">SUBMIT_PREFIX = run</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#check-command-squeue-j-job-id-s">CHECK_COMMAND = squeue -j %_(JOB_ID)s</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#submit-template">SUBMIT_TEMPLATE =</a></li>
<li class="toctree-l2"><a class="reference internal" href="#queues-default-job-gpus-0">QUEUES_DEFAULT = {“JOB_GPUS”: “0” }</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#https-thehatteronline-com-2014-11-18-turn-your-workstation-into-a-mini-grid-with-slurm-here-you-can-find-a-very-simple-tutorial-about-installing-slurm-in-ubuntu">https://thehatteronline.com/2014/11/18/turn-your-workstation-into-a-mini-grid-with-slurm/[Here] you can find a very simple tutorial about installing slurm in ubuntu</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/user-documentation.html">Getting Started</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install-from-sources.html">Installing from sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-plugins-command-line.html">Installing plugins from the command line</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>TODO: Host configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../sources/docs/scipion-modes/host-configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="todo-host-configuration">
<span id="host-configuration"></span><h1>TODO: Host configuration<a class="headerlink" href="#todo-host-configuration" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">toc:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">toc-placement!:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>image::https://github.com/I2PC/scipion/wiki/images/scipion_logo.gif[Scipion Logo, width=250]
<a href="#id1"><span class="problematic" id="id2">**</span></a><a href="#id3"><span class="problematic" id="id4">*</span></a></p>
<p>In Scipion the configuration file <code class="docutils literal notranslate"><span class="pre">scipion/config/hosts.conf</span></code> contains
some properties of the execution machine. (In a future release we are
planning to allow more than one machine to be configured and used to
launch jobs). This configuration file is particularly important for
clusters that use a Queue System. In this scenario, it is common that
users should write a submission script to launch jobs to the cluster. In
Scipion the submission scripts are generated from a template (that is
setup once by the system administrator) and the users no longer need to
care about it. In the following sections you can find the definition of
those parameters and also some examples that you can use as a starting
point.</p>
<p>toc::[]</p>
<p>== Parameters:</p>
<p>=== MPI command</p>
<hr class="docutils" />
<p>This variable reflect how to run programs using MPI in you computer.
This variable should be set even if you are not using a cluster (for
example in a multi-core machine). JOB_NODES will be replaced by the
number of MPI selected by the user in the form and the COMMAND with the
job launched by Scipion. This two should not be modified. In this
example we are using two parameters of MPI in our computer: <cite>–np</cite> and
<cite>–bynode=</cite>.</p>
<p>=== Queue System</p>
<p>When you run a protocol with “Use queue = Yes” the actual job
description file is created in the logs directory. For example,
<cite>ScipionUserData/projects/MyProject/Runs/000162_ProtCTFFind/logs/3162.job</cite>.
You can take a look at this file to see if everything is properly
defined (according to the requirements of your queue system) Following
is a description of each of the variables:</p>
<hr class="docutils" />
<p>With the NAME variable you can specify the name of your Queue System
(only a descriptive variable) that should not be empty. MANDATORYcan be
set to an integer number, it specify the number of processors from which
is mandatory to launch the jobs through the queue. (NOTE: MANDATORY = 0
means no restriction, old configuration use False which is equivalent to
0)</p>
<div class="section" id="submit-prefix-run">
<h2>SUBMIT_PREFIX = run<a class="headerlink" href="#submit-prefix-run" title="Permalink to this headline">¶</a></h2>
<p>The SUBMIT_PREFIX var is optional. It add a prefix to the generated
submit script, for example: run178.job. The default is to use only the
id as 178.job, but this cause problems in some clusters.</p>
<div class="section" id="check-command-squeue-j-job-id-s">
<h3>CHECK_COMMAND = squeue -j %_(JOB_ID)s<a class="headerlink" href="#check-command-squeue-j-job-id-s" title="Permalink to this headline">¶</a></h3>
<p>The previous variables are used to specify how to submit, cancel and
check jobs, respectively. In this case JOB_ID will be provided by
Scipion as well as the generated job file (JOB_SCRIPT). The examples
here are from Slurm, for Torque/PBS the commands are:
<cite>qsub, qdel, qstatus</cite>.</p>
</div>
</div>
<div class="section" id="submit-template">
<h2>SUBMIT_TEMPLATE =<a class="headerlink" href="#submit-template" title="Permalink to this headline">¶</a></h2>
<p>The SUBMIT_TEMPLATE variable contains the template that will be used to
generate the job script file. It can contains some special variables
that will be replaced by Scipion. Some of this variables can be specific
to your own queues and system, that should be defined in the QUEUES
variable. It is important that the lines of the template should be
indented so there are correctly associated to this variable. See the
examples in the next sections. I</p>
<blockquote>
<div><blockquote>
<div>[“JOB_TIME”, “120”, “Time (hours)”, “Select the time expected (in hours) for this job”]
]</div></blockquote>
<p>}</p>
</div></blockquote>
<hr class="docutils" />
<p>The QUEUES variable should contains the different queues that can be
used. It should be written as a JSON dictionary, where the key is the
queue name and the value is a list of parameters. Each parameter is
composed by a list of 4 values: (1) Variable Name, that can be used in
the template to be replaced, (2) The default value, (3) The variable
label that will be show to the users in the GUI and (4) A help message
that users can use to know the meaning of this queue parameter.</p>
<p>Keep in mind that the parameters defined here (like “JOB_TIME”, in the example) will be returned from the GUI dialog as a string. Hence, in the template you will need to declare them as string (%s), even if they are integers (%d). See the Torque example (JOB_HOURS parameter).</p>
</div>
<div class="section" id="queues-default-job-gpus-0">
<h2>QUEUES_DEFAULT = {“JOB_GPUS”: “0” }<a class="headerlink" href="#queues-default-job-gpus-0" title="Permalink to this headline">¶</a></h2>
<p>The QUEUES_DEFAULT variable is optional. It is only useful if you have
configured more than one queue, and some of the queue have distinct
parameters than the others. In this case, you need to provide a default
value (to be used in the template script) when other queues are
selected. The values must be set with the Key = Value inside braces.</p>
<p>== Example configurations</p>
<p>=== Example for <a class="reference external" href="http://slurm.schedmd.com/slurm.html[Slurm">http://slurm.schedmd.com/slurm.html[Slurm</a>]</p>
<div class="section" id="https-thehatteronline-com-2014-11-18-turn-your-workstation-into-a-mini-grid-with-slurm-here-you-can-find-a-very-simple-tutorial-about-installing-slurm-in-ubuntu">
<h3><a class="reference external" href="https://thehatteronline.com/2014/11/18/turn-your-workstation-into-a-mini-grid-with-slurm/[Here">https://thehatteronline.com/2014/11/18/turn-your-workstation-into-a-mini-grid-with-slurm/[Here</a>] you can find a very simple tutorial about installing slurm in ubuntu<a class="headerlink" href="#https-thehatteronline-com-2014-11-18-turn-your-workstation-into-a-mini-grid-with-slurm-here-you-can-find-a-very-simple-tutorial-about-installing-slurm-in-ubuntu" title="Permalink to this headline">¶</a></h3>
<p>[localhost]
PARALLEL_COMMAND = mpirun -np %_(JOB_NODES)d -bynode %_(COMMAND)s
NAME = SLURM
MANDATORY = False
SUBMIT_COMMAND = sbatch %_(JOB_SCRIPT)s
CANCEL_COMMAND = scancel %_(JOB_ID)s
CHECK_COMMAND = squeue -j %_(JOB_ID)s
SUBMIT_TEMPLATE = #!/bin/bash</p>
<blockquote>
<div><p>### Job name
#SBATCH -J %_(JOB_NAME)s
### Outputs (we need to escape the job id as %%j)
#SBATCH -o job%%j.out
#SBATCH -e job%%j.err
### Partition (queue) name
### if the system has only 1 queue, it can be omited
### if you want to specify the queue, ensure the name in the scipion dialog matches
### a slurm partition, then leave only 1 # sign in the next line
##### SBATCH -p %_(JOB_QUEUE)s</p>
<p>### Specify time, number of nodes (tasks), cores and memory(MB) for your job
#SBATCH –time=%_(JOB_TIME)s:00:00 –ntasks=%_(JOB_NODES)d –cpus-per-task=%_(JOB_THREADS)d –mem=%_(JOB_MEMORY)s
# Use as working dir the path where sbatch was launched
WORKDIR=$SLURM_JOB_SUBMIT_DIR</p>
<p>### Set environment varible to know running mode is non interactive
export XMIPP_IN_QUEUE=1</p>
<p>cd $WORKDIR
# Make a copy of node file
cp $SLURM_JOB_NODELIST %_(JOB_NODEFILE)s
# Calculate the number of processors allocated to this run.
NPROCS=`wc -l &lt; $SLURM_JOB_NODELIST`
# Calculate the number of nodes allocated.
NNODES=`uniq $SLURM_JOB_NODELIST | wc -l`</p>
<p>### Display the job context
echo Running on host <cite>hostname</cite>
echo Time is <cite>date</cite>
echo Working directory is <cite>pwd</cite>
echo Using ${NPROCS} processors across ${NNODES} nodes
echo NODE LIST:
cat $SLURM_JOB_NODELIST
#################################
%_(JOB_COMMAND)s</p>
</div></blockquote>
<dl class="docutils">
<dt>QUEUES = {</dt>
<dd><dl class="first last docutils">
<dt>“myslurmqueue”: [[“JOB_MEMORY”, “8192”, “Memory (MB)”, “Select amount of memory (in megabytes) for this job”],</dt>
<dd><blockquote class="first">
<div>[“JOB_TIME”, “120”, “Time (hours)”, “Select the time expected (in hours) for this job”]
]</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</dd>
</dl>
<hr class="docutils" />
<p>[[example-for-torque-pbs]]
=== Example for Torque-PBS</p>
<p>NAME = PBS/TORQUE
MANDATORY = False
SUBMIT_COMMAND = qsub %_(JOB_SCRIPT)s
SUBMIT_TEMPLATE = #!/bin/bash</p>
<blockquote>
<div>### Inherit all current environment variables
#PBS -V
### Job name
#PBS -N %_(JOB_NAME)s
### Queue name
###PBS -q %_(JOB_QUEUE)s
### Standard output and standard error messages
#PBS -k eo
### Specify the number of nodes and thread (ppn) for your job.
#PBS -l nodes=%_(JOB_REAL_NODES)s:ppn=%_(CPUS_PER_NODE)s
### Tell PBS the anticipated run-time for your job, where walltime=HH:MM:SS
#PBS -l walltime=%_(JOB_HOURS)s:00:00
# Memory per node
#PBS -l mem=%_(JOB_MEM)sg
# Use as working dir the path where qsub was launched
WORKDIR=$PBS_O_WORKDIR
#################################
### Set environment varible to know running mode is non interactive
export XMIPP_IN_QUEUE=1
### Switch to the working directory;
cd $WORKDIR
# Make a copy of PBS_NODEFILE
cp $PBS_NODEFILE %_(JOB_NODEFILE)s
# Calculate the number of processors allocated to this run.
NPROCS=`wc -l &lt; $PBS_NODEFILE`
# Calculate the number of nodes allocated.
NNODES=`uniq $PBS_NODEFILE | wc -l`
### Display the job context
echo Running on host <cite>hostname</cite>
echo Time is <cite>date</cite>
echo Working directory is <cite>pwd</cite>
echo Using ${NPROCS} processors across ${NNODES} nodes
echo PBS_NODEFILE:
cat $PBS_NODEFILE
#################################
%_(JOB_COMMAND)s</div></blockquote>
<p>CANCEL_COMMAND = canceljob %_(JOB_ID)s
CHECK_COMMAND = qstat %_(JOB_ID)s
QUEUES = { “mypbsqueue”: [ [“JOB_HOURS”, “120”, “Time (hours)”, “Select the expected job time”], [“JOB_REAL_NODES”, “1”, “Nodes”, “How many nodes the job needs”], [“CPUS_PER_NODE”, “8”, “CPUs”, “How many CPUs/node to use”], [“JOB_MEM”, “16”, “Memory (GB)”, “Define the memory per node for the job”] ] }
—————————————————————————————————————</p>
<p>[[example-for-sge]]
=== Example for SGE
This example is based on a config originally adapted by <a class="reference external" href="http://www.hpc.polito.it/">http://www.hpc.polito.it/</a>
—–
[localhost]
PARALLEL_COMMAND = mpirun
MANDATORY = False
NAME = SGE
CANCEL_COMMAND = /opt/sge6/bin/linux-x64/qdel %_(JOB_ID)s
CHECK_COMMAND = /opt/sge6/bin/linux-x64/qstat -j %_(JOB_ID)s
SUBMIT_COMMAND = /opt/sge6/bin/linux-x64/qsub %_(JOB_SCRIPT)s
SUBMIT_TEMPLATE = #!/bin/bash</p>
<blockquote>
<div><p>###====================================================###
#$ -V
#$ -S /bin/bash
#$ -cwd ### Use the current working directory
#$ -N scipion%_(JOB_NAME)s ### Job name
#$ -q %_(JOB_QUEUE)s ### Queue name
#$ -pe %_(JOB_PE)s %_(JOB_SLOTS)s
#$ -j y ### Merge stdin and stdout
###=======================================================#
#$ -l h_rt=%_(JOB_HOURS)s:00:00 ### Max run Time
#$ -l vf=%_(JOB_MAX_MEM)sG
###=====================================================###</p>
<p>%_(JOB_COMMAND)s</p>
</div></blockquote>
<dl class="docutils">
<dt>QUEUES = {</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>“ogequeue”: [</dt>
<dd><blockquote class="first">
<div>[“JOB_QUEUE”,”all.q”,”Queue Name:”,”Select the target queue”],
[“JOB_SLOTS”,”16”,”Total cores:”,”(MPI tasks x threads)”],
[“JOB_PE”,”orte”, “Parallel Environment (PE):”,”Select the OGE Parallel Environment)”],
[“JOB_HOURS”,”120”, “Hours:”,”Maximum amount of time allowed for this job”],
[“JOB_MAX_MEM”,”64”,”Mem(GB/node):”,”Set the memory per node that this job needs”]</div></blockquote>
<p class="last">]</p>
</dd>
</dl>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<hr class="docutils" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../user/user-documentation.html" class="btn btn-neutral float-right" title="Getting Started" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scipion-configuration.html" class="btn btn-neutral float-left" title="Scipion configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../../master/docs/scipion-modes/host-configuration.html">master</a></dd>
            <dd><a href="host-configuration.html">release-2.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>