

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyworkflow.install.script &mdash; Scipion 2.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../static/jquery.js"></script>
        <script type="text/javascript" src="../../../static/underscore.js"></script>
        <script type="text/javascript" src="../../../static/doctools.js"></script>
        <script type="text/javascript" src="../../../static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/banner.css" type="text/css" />
  <link rel="stylesheet" href="../../../static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Scipion
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Set up</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/how-to-install.html">How to install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/scipion-configuration.html">Scipion configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/scipion-modes/host-configuration.html">Host configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">User documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#graphical-interface-manuals">Graphical interface manuals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/user/user-documentation.html#processing-how-to-s">Processing How Toâ€™s</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/developer/developers.html">Developers Page</a></li>
</ul>
<p class="caption"><span class="caption-text">Facilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities.html">Streaming Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/facilities-workflows.html">Streaming workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/facilities/acquisition-simulation.html">Tutorial for Facilities</a></li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/pyworkflow.html">pyworkflow package</a></li>
</ul>
<p class="caption"><span class="caption-text">Get in touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/misc/contact-us.html">Contact Us</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Scipion</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyworkflow.install.script</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyworkflow.install.script</h1><div class="highlight"><pre>
<span></span><span class="c1"># **************************************************************************</span>
<span class="c1"># *</span>
<span class="c1"># * Authors:     J.M. De la Rosa Trevin (jmdelarosa@cnb.csic.es)</span>
<span class="c1"># *</span>
<span class="c1"># * Unidad de  Bioinformatica of Centro Nacional de Biotecnologia , CSIC</span>
<span class="c1"># *</span>
<span class="c1"># * This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># * it under the terms of the GNU General Public License as published by</span>
<span class="c1"># * the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># * (at your option) any later version.</span>
<span class="c1"># *</span>
<span class="c1"># * This program is distributed in the hope that it will be useful,</span>
<span class="c1"># * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># * GNU General Public License for more details.</span>
<span class="c1"># *</span>
<span class="c1"># * You should have received a copy of the GNU General Public License</span>
<span class="c1"># * along with this program; if not, write to the Free Software</span>
<span class="c1"># * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span>
<span class="c1"># * 02111-1307  USA</span>
<span class="c1"># *</span>
<span class="c1"># *  All comments concerning this program package may be sent to the</span>
<span class="c1"># *  e-mail address &#39;scipion@cnb.csic.es&#39;</span>
<span class="c1"># *</span>
<span class="c1"># **************************************************************************</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="kn">from</span> <span class="nn">funcs</span> <span class="k">import</span> <span class="n">Environment</span>

<span class="n">get</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="defineBinaries"><a class="viewcode-back" href="../../../api/pyworkflow.install.script.html#pyworkflow.install.script.defineBinaries">[docs]</a><span class="k">def</span> <span class="nf">defineBinaries</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the way to execute the script according to args &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1">#     SCIPION = sys.argv[0]</span>
    <span class="c1"># else:</span>
    <span class="c1">#     SCIPION = os.environ[&#39;SCIPION_HOME&#39;]</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

    <span class="n">noScipy</span> <span class="o">=</span> <span class="s1">&#39;--no-scipy&#39;</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;SCIPY&#39;</span><span class="p">)</span>

    <span class="c1">#  *******************************</span>
    <span class="c1">#  *  PATHS</span>
    <span class="c1">#  *******************************</span>
    <span class="c1"># GET the real path where scipion is installed</span>

    <span class="c1"># SCIPION = os.path.realpath(SCIPION)</span>
    <span class="c1"># SCIPION = os.path.dirname(SCIPION)</span>
    <span class="c1"># SCIPION = os.path.abspath(SCIPION)</span>


    <span class="n">SW_BIN</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getBinFolder</span><span class="p">()</span>
    <span class="n">SW_LIB</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getLibFolder</span><span class="p">()</span>
    <span class="n">SW_INC</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getIncludeFolder</span><span class="p">()</span>
    <span class="n">SW_TMP</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getTmpFolder</span><span class="p">()</span>
    <span class="n">SW_PYT_PACK</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">getPythonPackagesFolder</span><span class="p">()</span>

    <span class="c1">#  *******************************</span>
    <span class="c1">#  *  DETECT CURRENT INSTALLATION</span>
    <span class="c1">#  *******************************</span>
    <span class="c1"># Try to detect current installation and correct it if necessary</span>


    <span class="k">def</span> <span class="nf">clean_python_2_7_8_installation</span><span class="p">():</span>
        <span class="c1"># Detects installations where python 2.7.8 was installed.</span>
        <span class="c1"># In those installations we where using sqlite 3.6.23 and matplotlib-1.3.1</span>
        <span class="c1"># A bit of a hack but we will check based on matplotlib path!</span>
        <span class="c1"># Also this is not an exhaustive clean that might be more detailed</span>
        <span class="c1"># but enough to trigger the proper installation of the new versions.</span>

        <span class="n">oldMatplotLibPath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">getPythonPackagesFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/matplotlib-1.3.1*&#39;</span>

        <span class="k">def</span> <span class="nf">removeByPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># If old matplot lib exists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">oldMatplotLibPath</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OLD Installation identified: removing Python and sqlite&quot;</span><span class="p">)</span>

            <span class="c1"># remove sqlite3 3.6.23</span>
            <span class="n">sqliteLibs</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">getLibFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/libsqlite3*&quot;</span>
            <span class="n">removeByPattern</span><span class="p">(</span><span class="n">sqliteLibs</span><span class="p">)</span>

            <span class="n">sqliteInc</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">getIncludeFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/sqlite3*&quot;</span>
            <span class="n">removeByPattern</span><span class="p">(</span><span class="n">sqliteInc</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">getBinFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/sqlite3&quot;</span><span class="p">)</span>

            <span class="c1"># remove python installation</span>
            <span class="n">pythonBinaries</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">getBinFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/python*&quot;</span>
            <span class="n">removeByPattern</span><span class="p">(</span><span class="n">pythonBinaries</span><span class="p">)</span>

            <span class="c1"># Python at include</span>
            <span class="n">pythonIncludes</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">getIncludeFolder</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;/python2.7&quot;</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">pythonIncludes</span><span class="p">)</span>

            <span class="c1"># Python at lib folder</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">getPythonFolder</span><span class="p">())</span>

            <span class="k">return</span>


    <span class="n">clean_python_2_7_8_installation</span><span class="p">()</span>

    <span class="c1">#  ************************************************************************</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  *                              Libraries                               *</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  ************************************************************************</span>

    <span class="n">cmake</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;cmake&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;cmake-3.2.2.tgz&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getBin</span><span class="p">(</span><span class="s1">&#39;cmake&#39;</span><span class="p">)],</span>
        <span class="n">commands</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;cd &#39;</span> <span class="o">+</span> <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/cmake-3.2.2; &#39;</span>
                   <span class="s1">&#39;./bootstrap --prefix=../.. --parallel=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">getProcessors</span><span class="p">(),</span>
                   <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/cmake-3.2.2/Makefile&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;cd &#39;</span> <span class="o">+</span> <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/cmake-3.2.2; make install -j </span><span class="si">%d</span><span class="s1">&#39;</span>
                   <span class="o">%</span> <span class="n">env</span><span class="o">.</span><span class="n">getProcessors</span><span class="p">(),</span> <span class="n">SW_BIN</span> <span class="o">+</span> <span class="s1">&#39;/cmake&#39;</span><span class="p">)],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># In order to get both the float and double libraries of fftw</span>
    <span class="c1"># we need to execute ./configure; make; make install twice</span>
    <span class="c1"># see: http://www.fftw.org/fftw2_doc/fftw_6.html</span>
    <span class="n">fftw3</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;fftw3&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;fftw-3.3.4.tgz&#39;</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--enable-threads&#39;</span><span class="p">,</span> <span class="s1">&#39;--enable-shared&#39;</span><span class="p">],</span>
        <span class="n">clean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># We need to clean to configure again with --enable-float</span>

    <span class="n">fftw3f</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;fftw3f&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;fftw-3.3.4.tgz&#39;</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--enable-threads&#39;</span><span class="p">,</span> <span class="s1">&#39;--enable-shared&#39;</span><span class="p">,</span> <span class="s1">&#39;--enable-float&#39;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">osBuildDir</span> <span class="o">=</span> <span class="s1">&#39;tcl8.6.1/unix&#39;</span>
    <span class="n">osFlags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--enable-threads&#39;</span><span class="p">]</span>

    <span class="n">tcl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;tcl&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;tcl8.6.1-src.tgz&#39;</span><span class="p">,</span>
        <span class="n">buildDir</span><span class="o">=</span><span class="n">osBuildDir</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;tcl8.6&#39;</span><span class="p">)],</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">osFlags</span><span class="p">)</span>

    <span class="n">zlib</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;zlib&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)],</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;zlib-1.2.8.tgz&#39;</span><span class="p">,</span>
        <span class="n">configTarget</span><span class="o">=</span><span class="s1">&#39;zlib.pc&#39;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">osBuildDir</span> <span class="o">=</span> <span class="s1">&#39;tk8.6.1/unix&#39;</span>
    <span class="n">osFlags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--enable-threads&#39;</span><span class="p">]</span>

    <span class="n">tk</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;tk&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;tk8.6.1-src.tgz&#39;</span><span class="p">,</span>
        <span class="n">buildDir</span><span class="o">=</span><span class="n">osBuildDir</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;tk8.6&#39;</span><span class="p">)],</span>
        <span class="n">libChecks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;xft&#39;</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">osFlags</span><span class="p">,</span>
        <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">tcl</span><span class="p">,</span> <span class="n">zlib</span><span class="p">])</span>

    <span class="c1"># Special case: tk does not make the link automatically, go figure.</span>
    <span class="n">tk_wish</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="s1">&#39;tk_wish&#39;</span><span class="p">)</span>
    <span class="n">tk_wish</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span><span class="s1">&#39;ln -v -s wish8.6 wish&#39;</span><span class="p">,</span>
                       <span class="n">targets</span><span class="o">=</span><span class="n">SW_BIN</span> <span class="o">+</span> <span class="s1">&#39;/wish&#39;</span><span class="p">,</span>
                       <span class="n">cwd</span><span class="o">=</span> <span class="n">SW_BIN</span><span class="p">)</span>

    <span class="n">jpeg</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;libjpeg-turbo-1.3.1.tgz&#39;</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--without-simd&#39;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">png</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;png&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;libpng-1.6.16.tgz&#39;</span><span class="p">,</span>
        <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">zlib</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">tiff</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
         <span class="s1">&#39;tiff&#39;</span><span class="p">,</span>
         <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;tiff-4.0.10.tgz&#39;</span><span class="p">,</span>
         <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">zlib</span><span class="p">,</span> <span class="n">jpeg</span><span class="p">],</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">sqlite</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;SQLite-1a584e49.tgz&#39;</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CPPFLAGS=-w&#39;</span><span class="p">,</span>
               <span class="s1">&#39;CFLAGS=-DSQLITE_ENABLE_UPDATE_DELETE_LIMIT=1&#39;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">hdf5</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
         <span class="s1">&#39;hdf5&#39;</span><span class="p">,</span>
         <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;hdf5-1.8.14.tgz&#39;</span><span class="p">,</span>
         <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--enable-cxx&#39;</span><span class="p">,</span> <span class="s1">&#39;--enable-shared&#39;</span><span class="p">],</span>
         <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">),</span> <span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;hdf5_cpp&#39;</span><span class="p">)],</span>
         <span class="n">configAlways</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">zlib</span><span class="p">])</span>

    <span class="n">python</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;python&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;Python-2.7.15.tgz&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;python2.7&#39;</span><span class="p">),</span> <span class="n">env</span><span class="o">.</span><span class="n">getBin</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)],</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--enable-shared&#39;</span><span class="p">,</span> <span class="s1">&#39;--enable-unicode=ucs4&#39;</span><span class="p">],</span>
        <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">sqlite</span><span class="p">,</span> <span class="n">tk</span><span class="p">,</span> <span class="n">zlib</span><span class="p">])</span>

    <span class="n">pcre</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;pcre&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;pcre-8.36.tgz&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getBin</span><span class="p">(</span><span class="s1">&#39;pcretest&#39;</span><span class="p">)],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">swig</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;swig&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;swig-3.0.2.tgz&#39;</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getBin</span><span class="p">(</span><span class="s1">&#39;swig&#39;</span><span class="p">)],</span>
        <span class="n">makeTargets</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Source/Swig/tree.o&#39;</span><span class="p">],</span>
        <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">pcre</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">lapack</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;lapack&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;lapack-3.5.0.tgz&#39;</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-DBUILD_SHARED_LIBS:BOOL=ON&#39;</span><span class="p">,</span>
               <span class="s1">&#39;-DLAPACKE:BOOL=ON&#39;</span><span class="p">],</span>
        <span class="n">cmake</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">neededProgs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gfortran&#39;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">arpack</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;arpack&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;arpack-96.tgz&#39;</span><span class="p">,</span>
        <span class="n">neededProgs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gfortran&#39;</span><span class="p">],</span>
        <span class="n">commands</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;cd &#39;</span> <span class="o">+</span> <span class="n">SW_BIN</span> <span class="o">+</span> <span class="s1">&#39;; ln -s $(which gfortran) f77&#39;</span><span class="p">,</span>
                   <span class="n">SW_BIN</span> <span class="o">+</span> <span class="s1">&#39;/f77&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;cd &#39;</span> <span class="o">+</span> <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/arpack-96; make all&#39;</span><span class="p">,</span>
                   <span class="n">SW_LIB</span> <span class="o">+</span><span class="s1">&#39;/libarpack.a&#39;</span><span class="p">)],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># See http://modb.oce.ulg.ac.be/mediawiki/index.php/How_to_compile_ARPACK</span>

    <span class="n">cudaStr</span> <span class="o">=</span> <span class="s1">&#39;ON&#39;</span> <span class="k">if</span> <span class="n">get</span><span class="p">(</span><span class="s1">&#39;CUDA&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;OFF&#39;</span>
    <span class="n">opencvFlags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-DWITH_FFMPEG=OFF -DWITH_CUDA:BOOL=&#39;</span> <span class="o">+</span> <span class="n">cudaStr</span> <span class="o">+</span> <span class="s1">&#39;-DWITH_LIBV4L=ON-DWITH_V4L=OFF&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;OPENCV_VER&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;3.4.1&#39;</span><span class="p">:</span>
        <span class="n">opencvFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-DCMAKE_INSTALL_PREFIX=&#39;</span> <span class="o">+</span> <span class="n">env</span><span class="o">.</span><span class="n">getSoftware</span><span class="p">())</span>
        <span class="n">opencv</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
            <span class="s1">&#39;opencv&#39;</span><span class="p">,</span>
            <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;opencv-3.4.1.tgz&#39;</span><span class="p">,</span>
            <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;opencv_core&#39;</span><span class="p">)],</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">opencvFlags</span><span class="p">,</span>
            <span class="c1"># cmake=True,  # the instalation protocol have changed (e.g. mkdir build)</span>
            <span class="n">commands</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;cd &#39;</span> <span class="o">+</span> <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/opencv-3.4.1; mkdir build; cd build; &#39;</span>
                       <span class="s1">&#39;cmake &#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opencvFlags</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; .. ; &#39;</span>
                       <span class="s1">&#39;make -j &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">getProcessors</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;; &#39;</span>
                       <span class="s1">&#39;make install&#39;</span><span class="p">,</span> <span class="n">SW_LIB</span> <span class="o">+</span><span class="s1">&#39;/libopencv_core.so&#39;</span><span class="p">)],</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">opencv</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
            <span class="s1">&#39;opencv&#39;</span><span class="p">,</span>
            <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;opencv-2.4.13.tgz&#39;</span><span class="p">,</span>
            <span class="n">targets</span><span class="o">=</span><span class="p">[</span><span class="n">env</span><span class="o">.</span><span class="n">getLib</span><span class="p">(</span><span class="s1">&#39;opencv_core&#39;</span><span class="p">)],</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">opencvFlags</span><span class="p">,</span>
            <span class="n">cmake</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># ---------- Libraries required by PyTom</span>

    <span class="n">boost</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;boost&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;boost_1_56_0.tgz&#39;</span><span class="p">,</span>
        <span class="n">commands</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;cp -rf &#39;</span> <span class="o">+</span> <span class="n">SW_TMP</span> <span class="o">+</span> <span class="s1">&#39;/boost_1_56_0/boost &#39;</span> <span class="o">+</span> <span class="n">SW_INC</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
                   <span class="n">SW_INC</span> <span class="o">+</span> <span class="s1">&#39;/boost&#39;</span><span class="p">)],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">nfft3</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addLibrary</span><span class="p">(</span>
        <span class="s1">&#39;nfft3&#39;</span><span class="p">,</span>
        <span class="n">tar</span><span class="o">=</span><span class="s1">&#39;nfft-3.2.3.tgz&#39;</span><span class="p">,</span>
        <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">fftw3</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#  ************************************************************************</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  *                           Python Modules                             *</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  ************************************************************************</span>

    <span class="c1"># The flag &#39;--old-and-unmanageable&#39; used in some modules avoids</span>
    <span class="c1"># creating a single Python egg. That way the modules create a full</span>
    <span class="c1"># directory with the name of package, and we use that as a target.</span>

    <span class="c1"># Add pip to our python</span>
    <span class="n">pip</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addTarget</span><span class="p">(</span><span class="s1">&#39;pip&#39;</span><span class="p">)</span>
    <span class="c1"># we will install a certain version of setuptools</span>
    <span class="n">pip</span><span class="o">.</span><span class="n">addCommand</span><span class="p">(</span><span class="s1">&#39;python pyworkflow/install/get-pip.py -I --no-setuptools&#39;</span><span class="p">,</span>
                   <span class="n">targets</span><span class="o">=</span><span class="n">SW_PYT_PACK</span> <span class="o">+</span> <span class="s1">&#39;/pip&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Required python modules</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;setuptools&#39;</span><span class="p">,</span> <span class="s1">&#39;39.0.1&#39;</span><span class="p">)</span>
    <span class="n">numpy</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="s1">&#39;1.14.1&#39;</span><span class="p">)</span>
    <span class="n">matplotlib</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">,</span> <span class="s1">&#39;1.5.3&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;matplotlib-1.5.3*&#39;</span><span class="p">)</span>


    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;poster&#39;</span><span class="p">,</span> <span class="s1">&#39;0.8.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;poster-0.8.1*&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;psutil&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;psutil-2.1.1*&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;biopython&#39;</span><span class="p">,</span> <span class="s1">&#39;1.71&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;biopython-1.71*&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;mpi4py&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.0&#39;</span><span class="p">)</span>
    <span class="n">scipy</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;scipy&#39;</span><span class="p">,</span> <span class="s1">&#39;0.14.0&#39;</span><span class="p">,</span>
                             <span class="n">default</span><span class="o">=</span><span class="ow">not</span> <span class="n">noScipy</span><span class="p">,</span> <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">lapack</span><span class="p">,</span> <span class="n">matplotlib</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;bibtexparser&#39;</span><span class="p">,</span> <span class="s1">&#39;0.6.2&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">,</span> <span class="s1">&#39;1.5.5&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;Pillow&#39;</span><span class="p">,</span> <span class="s1">&#39;5.4.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Pillow-5.4.1*&#39;</span><span class="p">,</span>
                     <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">jpeg</span><span class="p">,</span> <span class="n">tiff</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;future&#39;</span><span class="p">,</span> <span class="s1">&#39;0.17.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;future-0.17.1*&#39;</span><span class="p">)</span>

    <span class="c1"># Optional python modules</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;paramiko&#39;</span><span class="p">,</span> <span class="s1">&#39;1.14.0&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># 1.4.8 could not be found ! Using latest available</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;winpdb&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.6&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;lxml&#39;</span><span class="p">,</span> <span class="s1">&#39;3.4.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;lxml-3.4.1*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="s1">&#39;2.18.4&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># These were dependencies of iPython</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;pyzmq&#39;</span><span class="p">,</span> <span class="s1">&#39;2.2.0.1&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;pyzmq*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;jinja2&#39;</span><span class="p">,</span> <span class="s1">&#39;2.7.3&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;tornado&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.2&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;ipython&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1.0&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;IPython&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cython</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;cython&#39;</span><span class="p">,</span> <span class="s1">&#39;0.22&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Cython-0.22*&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cythongsl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;cythongsl&#39;</span><span class="p">,</span> <span class="s1">&#39;0.2.1&#39;</span><span class="p">,</span>
                                 <span class="n">target</span><span class="o">=</span><span class="s1">&#39;CythonGSL-0.2.1*&#39;</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">cython</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">addPipModule</span><span class="p">(</span><span class="s1">&#39;scikit-learn&#39;</span><span class="p">,</span> <span class="s1">&#39;0.17&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;scikit_learn*&#39;</span><span class="p">,</span>
                     <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deps</span><span class="o">=</span><span class="p">[</span><span class="n">scipy</span><span class="p">,</span> <span class="n">cython</span><span class="p">])</span>


    <span class="c1">#  ************************************************************************</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  *                       External (EM) Packages                         *</span>
    <span class="c1">#  *                                                                      *</span>
    <span class="c1">#  ************************************************************************</span>

    <span class="c1"># &#39;commands&#39; is a list of (command, [targets]) to run after installation.</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>
<span class="sd">    relion_commands = [(&#39;./INSTALL.sh -j %d&#39; % env.getProcessors(),</span>
<span class="sd">                              [&#39;relion_build.log&#39;,</span>
<span class="sd">                               &#39;bin/relion_refine&#39;])]</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;relion&#39;, version=&#39;1.4&#39;,</span>
<span class="sd">                   tar=&#39;relion-1.4.tgz&#39;,</span>
<span class="sd">                   commands=relion_commands)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;relion&#39;, version=&#39;1.4f&#39;,</span>
<span class="sd">                   tar=&#39;relion-1.4_float.tgz&#39;,</span>
<span class="sd">                   commands=relion_commands)</span>
<span class="sd">    </span>
<span class="sd">    # Define FFTW3 path variables</span>
<span class="sd">    relion_vars = [(&#39;FFTW_LIB&#39;, SW_LIB),</span>
<span class="sd">                   (&#39;FFTW_INCLUDE&#39;, SW_INC)]</span>
<span class="sd">    </span>
<span class="sd">    relion2_commands = [(&#39;cmake -DGUI=OFF -DCMAKE_INSTALL_PREFIX=./ .&#39;, []),</span>
<span class="sd">                        (&#39;make -j %d&#39; % env.getProcessors(), [&#39;bin/relion_refine&#39;])]</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;relion&#39;, version=&#39;2.0&#39;,</span>
<span class="sd">                   tar=&#39;relion-2.0.4.tgz&#39;,</span>
<span class="sd">                   commands=relion2_commands,</span>
<span class="sd">                   updateCuda=True,</span>
<span class="sd">                   vars=relion_vars)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;relion&#39;, version=&#39;2.1&#39;,</span>
<span class="sd">                  tar=&#39;relion-2.1.tgz&#39;,</span>
<span class="sd">                  commands=relion2_commands,</span>
<span class="sd">                  updateCuda=True,</span>
<span class="sd">                  vars=relion_vars)</span>
<span class="sd">    </span>
<span class="sd">    eman2_commands = [(&#39;./eman2-installer&#39;,</span>
<span class="sd">                       &#39;eman2.*rc&#39;)]</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;eman&#39;, version=&#39;2.11&#39;,</span>
<span class="sd">                   tar=&#39;eman2.11.linux64.tgz&#39;,</span>
<span class="sd">                   commands=eman2_commands)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;eman&#39;, version=&#39;2.12&#39;,</span>
<span class="sd">                   tar=&#39;eman2.12.linux64.tgz&#39;,</span>
<span class="sd">                   commands=eman2_commands)</span>
<span class="sd">    </span>
<span class="sd">    SW_EM = env.getEmFolder()</span>
<span class="sd">    </span>
<span class="sd">    eman22_commands = [(&#39;./eman2.21.linux64.centos7.sh -b -p &quot;%s/eman-2.21&quot;&#39; %</span>
<span class="sd">                        SW_EM, &#39;%s/eman-2.21/bin/python&#39; % SW_EM)]</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;eman&#39;, version=&#39;2.21&#39;,</span>
<span class="sd">                   tar=&#39;eman2.21.linux64.centos7.tgz&#39;,</span>
<span class="sd">                   commands=eman22_commands)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;localrec&#39;, version=&#39;1.1.0&#39;,</span>
<span class="sd">                   tar=&#39;localrec-1.1.0.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;localrec&#39;, version=&#39;1.2.0&#39;,</span>
<span class="sd">                   tar=&#39;localrec-1.2.0.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;locscale&#39;, version=&#39;0.1&#39;,</span>
<span class="sd">                   tar=&#39;locscale-0.1.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;resmap&#39;, version=&#39;1.1.5s2&#39;,</span>
<span class="sd">                   tar=&#39;resmap-1.1.5-s2.tgz&#39;,</span>
<span class="sd">                   deps=[&#39;scipy&#39;])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;spider&#39;, version=&#39;21.13&#39;,</span>
<span class="sd">                   tar=&#39;spider-web-21.13.tgz&#39;,</span>
<span class="sd">                   neededProgs=[&#39;csh&#39;])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;motioncorr&#39;, version=&#39;2.1&#39;,</span>
<span class="sd">                   tar=&#39;motioncorr_v2.1.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;motioncor2&#39;, version=&#39;17.01.30&#39;,</span>
<span class="sd">                   tar=&#39;motioncor2_01302017.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;motioncor2&#39;, version=&#39;1.0.2&#39;,</span>
<span class="sd">                   tar=&#39;motioncor2-1.0.2.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;motioncor2&#39;, version=&#39;1.0.5&#39;,</span>
<span class="sd">                   tar=&#39;motioncor2-1.0.5.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;motioncor2&#39;, version=&#39;1.1.0&#39;,</span>
<span class="sd">                   tar=&#39;motioncor2-1.1.0.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;simple&#39;, version=&#39;2.1&#39;,</span>
<span class="sd">                   tar=&#39;simple2.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;chimera&#39;, version=&#39;1.10.1&#39;,</span>
<span class="sd">                   tar=&#39;chimera-1.10.1-linux_x86_64.tgz&#39;,</span>
<span class="sd">                   targetDir=&#39;chimera-1.10.1&#39;,</span>
<span class="sd">                   commands=[(&#39;./scipion_installer&#39;,&#39;bin/chimera&#39;)])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;nma&#39;,</span>
<span class="sd">                   tar=&#39;nma.tgz&#39;,</span>
<span class="sd">                   commands=[(&#39;cd ElNemo; make; mv nma_* ..&#39;, &#39;nma_elnemo_pdbmat&#39;),</span>
<span class="sd">                             (&#39;cd NMA_cart; LDFLAGS=-L%s make; mv nma_* ..&#39; %</span>
<span class="sd">                              Environment.getLibFolder(), &#39;nma_diag_arpack&#39;)],</span>
<span class="sd">                   deps=[&#39;arpack&#39;])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;cryoem&#39;, version=&#39;1.0&#39;,</span>
<span class="sd">                    tar=&#39;cryoem-1.0.tgz&#39;,</span>
<span class="sd">                    pythonMod=True, default=False,</span>
<span class="sd">                    deps=[scipy, matplotlib, cythongsl])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;powerfit&#39;, version=&#39;2.0&#39;,</span>
<span class="sd">                    tar=&#39;powerfit.tgz&#39;,</span>
<span class="sd">                    targets=[&#39;powerfit-2.0*&#39;],</span>
<span class="sd">                    pythonMod=True, default=False,</span>
<span class="sd">                    deps=[numpy, scipy, fftw3])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;gEMpicker&#39;, version=&#39;1.1&#39;,</span>
<span class="sd">                   tar=&#39;gEMpicker_v1.1.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;gctf&#39;, version=&#39;0.50&#39;,</span>
<span class="sd">                   tar=&#39;Gctf_v0.50.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;gctf&#39;, version=&#39;1.06&#39;,</span>
<span class="sd">                   tar=&#39;Gctf_v1.06.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;gautomatch&#39;, version=&#39;0.53&#39;,</span>
<span class="sd">                   tar=&#39;Gautomatch_v0.53.tgz&#39;)</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;ethan&#39;, version=&#39;1.2&#39;,</span>
<span class="sd">                   tar=&#39;ethan-1.2.tgz&#39;,</span>
<span class="sd">                   commands=[(&#39;make&#39;, &#39;ethan&#39;)])</span>
<span class="sd">    </span>
<span class="sd">    fsc_commands = [(&#39;conda env create -f environment.yml &amp;&amp; touch IS_INSTALLED&#39;,</span>
<span class="sd">                     &#39;IS_INSTALLED&#39;)]</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;nysbc-3DFSC&#39;, version=&#39;2.5&#39;,</span>
<span class="sd">                   tar=&#39;nysbc-3DFSC_2.5.tgz&#39;,</span>
<span class="sd">                   commands=fsc_commands,</span>
<span class="sd">                   neededProgs=[&#39;conda&#39;])</span>
<span class="sd">    </span>
<span class="sd">    env.addPackage(&#39;cryoEF&#39;, version=&#39;1.1.0&#39;,</span>
<span class="sd">                   tar=&#39;cryoEF_v1.1.0.tgz&#39;)</span>
<span class="sd">                   </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">env</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Scipion team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: release-2.0.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="script.html">release-2.0.0</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>